<script type="text/javascript">
    RED.nodes.registerType('knxUltimate-config',{
        category: 'config',
        defaults: {
            host: {value:"224.0.23.12",required:true},
            port: {value:3671,required:true,validate:RED.validators.number()},
            interface: {value:"eth0",required:true},
            // the KNX physical address we'd like to use
            physAddr: {value:"15.15.22",required:true},
            // enable this option to suppress the acknowledge flag with outgoing L_Data.req requests. LoxOne needs this
            suppress_ack_ldatareq: {value: false},
            csv: {value:"",required:false}
        },
        oneditsave: function() {
            // Check if the csv file contains errors
            if($("#node-config-input-csv").val() != 'undefined' && $("#node-config-input-csv").val()!=""){
                var checkResult="Upon deploy, i'll parse the CSV. Please see the debug TAB or node-red's log for errors/warnings. If no warnings, then the csv is OK. Otherwise you should correct the issues and again export from ETS and paste here."
                var myNotification= RED.notify(checkResult,
                {
                    modal: true,
                    fixed: true,
                    type: 'info',
                    buttons: [
                        {
                            text: "OK",
                            click: function(e) {
                                myNotification.close();
                            }
                        }]
                })
            }
        },
        label: function() {
            return this.host+":"+this.port;
        }
    });
</script>

<script type="text/x-red" data-template-name="knxUltimate-config">
    <div class="form-row">
        <label for="node-config-input-host"><i class="icon-bookmark"></i> Host</label>
        <input type="text" id="node-config-input-host">
    </div>
    <div class="form-row">
        <label for="node-config-input-port"><i class="icon-bookmark"></i> Port</label>
        <input type="text" id="node-config-input-port">
    </div>

    <div class="form-row">
        <label for="node-config-input-interface"><i class="icon-bookmark"></i> ETH Interface</label>
        <input type="text" id="node-config-input-interface">
    </div>
    <div class="form-row">
        <label for="node-config-input-physAddr"><i class="icon-bookmark"></i> KNX Physical Addrress</label>
        <input type="text" id="node-config-input-physAddr">
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-input-suppress_ack_ldatareq" style="display:inline-block; width:auto; vertical-align:top;">
        <label style="width:auto" for="node-input-suppress_ack_ldatareq"> Suppress ACK request</label>
        <div id="helpallga"> This option help compatibility with old Siemens SWG1 148-1AB22 IP Interface firmware</div>
    </div>

    <div class="form-row">
        <label for="node-config-input-csv"><i class="icon-bookmark"></i> ETS Group Addresses list</label>
        <br /><i>On ETS, click the group addresses list, then right click, then select 'export group addresses'. On the export window, select these options -> Output Format: CSV, CSV Format: 1/1 Name/Address, Export with header line: checked, CSV Separator: Tabulator. </i><br />
        <a href="https://youtu.be/I32_qG7yhFc" target="_blank">See how on Youtube</a>
        <textarea rows=20 id="node-config-input-csv" style="width:100%" placeholder="Paste here your CSV exported file from ETS">
    </div>
</script>

<script type="text/x-red" data-help-name="knxUltimate-config">
<p><b>ETS Group Addresses list</b>: Optionally, you can paste here the CSV file from ETS. This CSV will then be used by the knxUltimate node (if you select "Listen to all Group Addresses" on the knxUltimate node) to automatically decode all the raw values received from the KNX bus. These values will then be outputted by the msg.payload</p>
</script>